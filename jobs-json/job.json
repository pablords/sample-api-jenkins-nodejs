{
    "flow-definition": {
        "$": {
            "plugin": "workflow-job@1174.vdcb_d054cf74a_"
        },
        "keepDependencies": [
            "false"
        ],
        "properties": [
            {
                "org.jenkinsci.plugins.workflow.job.properties.PipelineTriggersJobProperty": [
                    {
                        "triggers": [
                            {
                                "hudson.triggers.TimerTrigger": [
                                    {
                                        "spec": [
                                            "@midnight"
                                        ]
                                    }
                                ]
                            }
                        ]
                    }
                ]
            }
        ],
        "definition": [
            {
                "$": {
                    "class": "org.jenkinsci.plugins.workflow.cps.CpsFlowDefinition",
                    "plugin": "workflow-cps@2680.vf642ed4fa_d55"
                },
                "script": [
                    "podTemplate(\n    containers: [\n        containerTemplate(name: 'kubectl', image: 'pablords/kubectl:latest', command: 'sleep', args: '99d')\n    ]\n  ) {\n\n    environment {\n        VAULT_URL = 'http://devops-dev.ddns.net:8083'\n    }\n    node(POD_LABEL) {\n        \n    \n    def secrets = [\n        [path: 'kv/jenkins/kubeconfig', engineVersion: 1, secretValues: [\n            [envVar: 'kubeconfig', vaultKey: 'file']\n            ]\n        ]\n    ]\n\n\n    def configuration = [\n        vaultUrl: env.VAULT_URL,\n        vaultCredentialId: 'VAULT_APP_ROLE_CREDENTIAL',\n        engineVersion: 1\n    ]\n       \n    \n        stage('get secret'){\n            container('kubectl'){\n                stage('decode base64'){\n                    withVault([configuration: configuration, vaultSecrets: secrets]) {\n                        byte[] decoded = env.kubeconfig.decodeBase64()\n                        def decode = new String(decoded)\n                        writeFile file: 'config', text: decode\n                        sh 'mkdir ${WORKSPACE}/.kube'\n                        sh 'mv config ${WORKSPACE}/.kube'\n                        sh 'cat ${WORKSPACE}/.kube/config'\n\n                    }\n                }\n                \n                    \n               stage('command') {\n                    sh \"kubectl --kubeconfig ${WORKSPACE}/.kube/config get pods --all-namespaces\"\n                }\n\n            }\n        }\n        \n    }\n}"
                ],
                "sandbox": [
                    "false"
                ]
            }
        ],
        "triggers": [
            ""
        ],
        "disabled": [
            "false"
        ]
    }
}